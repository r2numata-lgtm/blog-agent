# 要件定義

**ドキュメントバージョン**: 1.0  
**最終更新日**: 2024-12-03  
**関連ドキュメント**: 00_project_overview.md, 02_architecture.md

---

## 📋 要件定義の目的

このドキュメントでは、ブログ生成エージェントMVP（Option A）の機能要件と非機能要件を定義します。

---

## ✅ 機能要件

### FR-001: ユーザー認証

#### FR-001-1: ユーザー登録
- ユーザーはメールアドレスとパスワードで新規登録できる
- メール認証が完了するまでログインできない
- パスワードは8文字以上、英数字混在必須

#### FR-001-2: ログイン/ログアウト
- 登録済みユーザーはログインできる
- セッションは7日間有効
- ログアウト機能を提供

#### FR-001-3: パスワードリセット
- メールアドレスでパスワードリセットリンクを受信できる
- リセットリンクは24時間有効

**実装方法**: AWS Cognito  
**優先度**: 高  
**関連**: 02_architecture.md

---

### FR-002: 記事生成

#### FR-002-1: 入力フォーム
ユーザーは以下の情報を入力できる：
- **記事タイトル**（必須、最大100文字）
- **対象読者**（任意、最大50文字）
- **記事の目的**（任意、最大200文字）
- **キーワード**（任意、カンマ区切り、最大10個）
- **本文の要点**（必須、最大2000文字）
- **文字数指定**（選択式: 1000-1500 / 1500-2000 / 2000-3000）

#### FR-002-2: 記事生成実行
- 「生成」ボタンクリックでClaude APIに記事生成をリクエスト
- 生成中はローディング表示
- 生成時間: 平均20-40秒
- エラー時は明確なエラーメッセージを表示

#### FR-002-3: 生成結果
- Markdown + 独自タグ形式で出力
- リアルタイムプレビューに表示
- 生成後も編集可能

**実装方法**: Claude API (claude-sonnet-4-20250514)  
**優先度**: 高  
**関連**: 07_prompt_templates.md

---

### FR-003: エディタ機能

#### FR-003-1: Markdownエディタ
- シンタックスハイライト
- 行番号表示
- 自動保存（30秒ごと）
- Undo/Redo機能

#### FR-003-2: 装飾挿入
ボタンクリックで以下の装飾タグを挿入：
- **情報ボックス**: `:::box type="info"`
- **警告ボックス**: `:::box type="warning"`
- **成功ボックス**: `:::box type="success"`
- **エラーボックス**: `:::box type="error"`
- **吹き出し（左）**: `:::balloon position="left"`
- **吹き出し（右）**: `:::balloon position="right"`

#### FR-003-3: プレビュー同期
- エディタの内容がリアルタイムでプレビューに反映
- デバウンス処理（300ms）で負荷軽減
- スクロール同期（オプション）

**実装方法**: Monaco Editor or CodeMirror  
**優先度**: 高  
**関連**: 05_frontend_design.md

---

### FR-004: プレビュー機能

#### FR-004-1: Markdownレンダリング
- Markdownを装飾付きHTMLに変換
- 独自タグを適切なHTML+CSSに変換
- レスポンシブ対応

#### FR-004-2: 装飾スタイル適用
- プリセット装飾スタイルを適用
- ユーザーのカスタムCSS反映（MVP後）

**実装方法**: marked.js + カスタムレンダラー  
**優先度**: 高  
**関連**: 05_frontend_design.md

---

### FR-005: 出力機能

#### FR-005-1: HTML出力
- 「HTML出力」ボタンでWordPress用HTMLを生成
- 装飾CSS込みのHTMLファイルをダウンロード
- ファイル名: `{記事タイトル}_YYYYMMDD.html`

#### FR-005-2: CSS出力
- 装飾用CSSファイルを別途ダウンロード可能
- ユーザーがWordPressテーマに追加して使用

#### FR-005-3: コピー機能
- HTMLコードをクリップボードにコピー
- Markdownコードをクリップボードにコピー

**実装方法**: フロントエンドでの変換処理  
**優先度**: 高  
**関連**: 05_frontend_design.md

---

### FR-006: 記事管理

#### FR-006-1: 記事一覧
- 生成した記事の一覧を表示
- タイトル、生成日時、文字数を表示
- ページネーション（20件/ページ）

#### FR-006-2: 記事保存
- 生成した記事を保存
- 下書き状態で保持
- 最大保存数: 50件（MVP）

#### FR-006-3: 記事削除
- 保存した記事を削除
- 削除確認ダイアログ表示

**実装方法**: DynamoDB  
**優先度**: 中  
**関連**: 03_database_schema.md

---

## 🚫 非機能要件

### NFR-001: パフォーマンス

#### NFR-001-1: レスポンス時間
- API応答時間: p95 < 3秒
- フロント初回読み込み: < 2秒
- プレビュー更新: < 300ms

#### NFR-001-2: スケーラビリティ
- 同時ユーザー: 50人対応
- 1ユーザーあたり同時リクエスト: 3件

**測定方法**: CloudWatch, Lighthouseスコア  
**関連**: 09_testing_strategy.md

---

### NFR-002: セキュリティ

#### NFR-002-1: 認証・認可
- JWT トークンでAPI認証
- トークン有効期限: 1時間（自動更新）
- HTTPS通信必須

#### NFR-002-2: データ保護
- パスワードはハッシュ化（Cognito管理）
- S3バケットは非公開
- DynamoDB暗号化有効

#### NFR-002-3: 入力バリデーション
- すべてのユーザー入力をサニタイズ
- XSS対策
- SQLインジェクション対策（DynamoDBのため低リスク）

**実装方法**: AWS WAF, Cognito, Lambda Authorizer  
**関連**: 02_architecture.md, 06_backend_design.md

---

### NFR-003: 可用性

#### NFR-003-1: 稼働率
- 目標稼働率: 99.5%以上
- 計画メンテナンス: 月1回、最大2時間

#### NFR-003-2: エラーハンドリング
- Lambda エラー率: < 1%
- ユーザーフレンドリーなエラーメッセージ
- 自動リトライ機能（API呼び出し）

**監視方法**: CloudWatch Alarms  
**関連**: 08_deployment_guide.md

---

### NFR-004: ユーザビリティ

#### NFR-004-1: レスポンシブデザイン
- デスクトップ: 1280px以上
- タブレット: 768px-1279px
- モバイル: 375px-767px

#### NFR-004-2: アクセシビリティ
- キーボード操作対応
- スクリーンリーダー対応
- カラーコントラスト比 4.5:1以上

#### NFR-004-3: ブラウザ対応
- Chrome（最新版）
- Safari（最新版）
- Firefox（最新版）
- Edge（最新版）

**検証方法**: Lighthouse, axe DevTools  
**関連**: 05_frontend_design.md

---

### NFR-005: 保守性

#### NFR-005-1: コード品質
- TypeScript型カバレッジ: 80%以上
- ESLintルール遵守
- コードレビュー必須

#### NFR-005-2: ドキュメント
- すべてのAPI仕様を文書化
- コンポーネント仕様を文書化
- デプロイ手順を文書化

#### NFR-005-3: ログ・監視
- すべてのAPI呼び出しをログ記録
- エラーログの保持期間: 30日
- パフォーマンスメトリクスの記録

**ツール**: CloudWatch Logs, CloudWatch Metrics  
**関連**: 08_deployment_guide.md

---

## 🔄 MVP後の追加要件（参考）

以下はMVP（Option A）では実装しないが、将来的に追加予定の要件：

### 将来要件-001: WordPress自動投稿
- WordPress REST APIで自動投稿
- 複数サイト管理
- 予約投稿機能

### 将来要件-002: ナレッジベース
- 過去記事の参照
- ユーザーの執筆スタイル学習
- キーワード自動提案

### 将来要件-003: 高度な装飾
- カスタム装飾作成UI
- 装飾プリセットの共有
- 装飾のインポート/エクスポート

### 将来要件-004: SEO機能
- キーワード密度分析
- メタディスクリプション生成
- 内部リンク提案

→ 詳細は **10_change_log.md** で機能追加時に記録

---

## 📊 要件の優先度マトリクス

| 要件ID | 機能 | 優先度 | MVP含む | 実装難易度 |
|--------|------|--------|---------|-----------|
| FR-001 | ユーザー認証 | 高 | ✅ | 低（Cognito） |
| FR-002 | 記事生成 | 高 | ✅ | 中 |
| FR-003 | エディタ | 高 | ✅ | 中 |
| FR-004 | プレビュー | 高 | ✅ | 中 |
| FR-005 | 出力機能 | 高 | ✅ | 低 |
| FR-006 | 記事管理 | 中 | ✅ | 低 |

---

## 🎯 受け入れ基準

各要件の完了判定基準：

### FR-001 受け入れ基準
- [ ] ユーザー登録→メール認証→ログインの一連の流れが動作
- [ ] パスワードリセット機能が動作
- [ ] セッション管理が正常に動作

### FR-002 受け入れ基準
- [ ] 入力フォームのバリデーションが動作
- [ ] Claude APIから記事が正常に生成される
- [ ] エラー時に適切なメッセージが表示される

### FR-003 受け入れ基準
- [ ] エディタで快適に編集できる
- [ ] 装飾タグの挿入が正常に動作
- [ ] プレビュー同期が300ms以内で反映

### FR-004 受け入れ基準
- [ ] Markdownが正しくHTMLに変換される
- [ ] 独自タグが適切にレンダリングされる
- [ ] レスポンシブ表示が正常

### FR-005 受け入れ基準
- [ ] HTMLファイルがダウンロードできる
- [ ] CSSファイルがダウンロードできる
- [ ] クリップボードコピーが動作

### FR-006 受け入れ基準
- [ ] 記事の保存・読み込みが動作
- [ ] 記事一覧が表示される
- [ ] 記事の削除が動作

---

## 🔗 制約事項

### 技術的制約
- Claude API: トークン制限（入力200K, 出力16K）
- Lambda: タイムアウト15分、メモリ最大10GB
- DynamoDB: 項目サイズ最大400KB
- Cognito: 無料枠 50,000 MAU

### ビジネス的制約
- MVP開発期間: 3ヶ月以内
- 初期コスト: $200/月以内
- 初期ユーザー数: 100人想定

---

## 📝 変更管理

要件の変更が発生した場合：

1. **10_change_log.md** に変更理由・影響範囲を記録
2. このドキュメントを更新
3. 関連ドキュメント（02, 03, 04, 05, 06）の更新確認
4. **99_task_management.md** でタスクを調整

---

**最終更新**: 2024-12-03  
**承認者**: れんじろう  
**次回レビュー**: Phase 1完了時
