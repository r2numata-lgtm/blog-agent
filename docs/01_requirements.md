# 要件定義

**ドキュメントバージョン**: 2.0  
**最終更新日**: 2025-01-03  
**関連ドキュメント**: 00_project_overview.md, 02_architecture.md

---

## 📋 要件定義の目的

このドキュメントでは、ブログ生成エージェント（本開発版）の機能要件と非機能要件を定義します。

**重要な変更:**
- MVPアプローチを廃止し、最初から本格開発
- WordPress Gutenberg完全対応
- チャットベースの記事修正機能
- 記事スタイル統一のための初期設定機能

---

## ✅ 機能要件

### FR-001: ユーザー認証

#### FR-001-1: ユーザー登録
- ユーザーはメールアドレスとパスワードで新規登録できる
- メール認証が完了するまでログインできない
- パスワードは8文字以上、英数字混在必須

#### FR-001-2: ログイン/ログアウト
- 登録済みユーザーはログインできる
- セッションは7日間有効
- ログアウト機能を提供

#### FR-001-3: パスワードリセット
- メールアドレスでパスワードリセットリンクを受信できる
- リセットリンクは24時間有効

**実装方法**: AWS Cognito  
**優先度**: 高  
**関連**: 02_architecture.md

---

### FR-002: 記事初期設定

#### FR-002-1: 記事スタイル設定
ユーザーは記事の統一感を出すために以下を設定できる：
- **記事のテイスト**: 
  - フォーマル / カジュアル / 親しみやすい / 専門的
  - 一人称: 私 / 僕 / 筆者
  - 読者への呼びかけ: あなた / 皆さん / ○○な方
- **トーン**: 
  - 説明的 / ストーリー形式 / Q&A形式
  - 導入の書き方（問題提起 / 共感 / 質問形式）

#### FR-002-2: サンプル記事設定
- 既存のブログ記事をサンプルとしてアップロード（HTML/Markdown）
- サンプル記事から文体・構成を学習
- 最大3記事まで設定可能

#### FR-002-3: 装飾プリセット設定
使用する装飾を選択：
- **情報ボックス**: 使用する / 使用しない
- **警告ボックス**: 使用する / 使用しない
- **成功ボックス**: 使用する / 使用しない
- **吹き出し**: 使用する / 使用しない
- **引用**: 使用する / 使用しない
- **表**: 使用する / 使用しない

#### FR-002-4: SEO設定
- デフォルトのメタディスクリプション長（120-160文字）
- キーワード数の上限（5-10個）

**実装方法**: フロントエンド + DynamoDB  
**優先度**: 高  
**関連**: 03_database_schema.md

---

### FR-003: 記事生成

#### FR-003-1: 入力フォーム
ユーザーは以下の情報を入力：
- **本文の要点**（必須、最大3000文字）
  - 記事で伝えたいこと
  - 含めたい情報
  - 構成の指示
- **記事タイトル**（任意、最大100文字）
  - 未入力の場合、AIが自動生成
- **内部リンク記事**（任意、最大5記事）
  - 公開済み記事のURL
  - 記事タイトル
  - 簡単な説明

#### FR-003-2: 記事生成実行
- 「生成」ボタンでClaude APIにリクエスト
- 生成中はプログレス表示
  - ステップ1: タイトル生成
  - ステップ2: 構成作成
  - ステップ3: 本文生成
  - ステップ4: メタ情報生成
- 生成時間: 平均30-60秒
- エラー時は明確なエラーメッセージ

#### FR-003-3: 生成結果
AIが以下を生成：
- **本文**: Gutenbergブロック形式
- **タイトル**: 未入力時のみ生成（3案提示）
- **メタディスクリプション**: 120-160文字
- **メタキーワード**: 5-10個
- **スラッグ**: URL用（英数字、ハイフン）
- **内部リンク提案**: 適切な箇所に内部リンクを挿入

#### FR-003-4: タイトル選択
- タイトル未入力時、3案から選択
- カスタムタイトル入力も可能
- 選択後、再生成不要

**実装方法**: Claude API (claude-sonnet-4-20250514)  
**優先度**: 高  
**関連**: 07_prompt_templates.md

---

### FR-004: チャットベース記事修正

#### FR-004-1: 会話形式の修正
生成後、チャットで記事を修正：
- **部分修正**: 「導入部分をもっと詳しく」
- **追加**: 「具体例を2つ追加して」
- **削除**: 「この段落は不要」
- **トーン変更**: 「もっとカジュアルに」
- **構成変更**: 「順番を入れ替えて」

#### FR-004-2: 修正履歴
- 修正前後の差分表示
- 「元に戻す」機能
- 修正履歴の保存（最大10件）

#### FR-004-3: 部分選択修正
- エディタで範囲選択
- 選択部分のみを修正指示
- 「この部分をリライトして」

**実装方法**: Claude API（会話履歴管理）  
**優先度**: 高  
**関連**: 06_backend_design.md

---

### FR-005: エディタ機能

#### FR-005-1: Gutenbergブロックエディタ
- WordPress Gutenbergと同等の編集体験
- ブロック単位での編集
- ドラッグ&ドロップで並び替え
- ブロックの追加・削除

#### FR-005-2: 対応ブロック
**基本ブロック:**
- 段落（Paragraph）
- 見出し（Heading: H2-H6）
- リスト（List: 順序付き/順序なし）
- 引用（Quote）
- 画像（Image）※プレースホルダー
- 表（Table）

**装飾ブロック:**
- グループ（Group）- 背景色・パディング設定可能
- カラム（Columns）
- スペーサー（Spacer）

#### FR-005-3: リアルタイムプレビュー
- エディタの内容がリアルタイムで反映
- WordPressテーマ風のスタイル適用
- レスポンシブプレビュー（Desktop/Tablet/Mobile）

**実装方法**: Gutenberg互換エディタライブラリ  
**優先度**: 高  
**関連**: 05_frontend_design.md

---

### FR-006: 出力機能

#### FR-006-1: Gutenbergブロック形式出力
- WordPress Gutenbergブロック形式でHTMLを生成
- コメント付きHTML（`<!-- wp:paragraph -->` 形式）
- そのままWordPressに貼り付け可能

#### FR-006-2: メタ情報出力
以下を整形してコピー可能：
```
タイトル: [生成されたタイトル]
スラッグ: [生成されたスラッグ]
メタディスクリプション: [生成されたメタディスクリプション]
メタキーワード: [キーワード1, キーワード2, ...]
```

#### FR-006-3: エクスポート機能
- **HTMLファイル**: Gutenbergブロック形式
- **JSONファイル**: ブロックデータ（再編集用）
- **テキストファイル**: メタ情報のみ

#### FR-006-4: コピー機能
- ワンクリックでHTMLをクリップボードにコピー
- メタ情報を個別にコピー
- 全体をまとめてコピー

**実装方法**: フロントエンドでの変換処理  
**優先度**: 高  
**関連**: 05_frontend_design.md

---

### FR-007: 記事管理

#### FR-007-1: 記事一覧
- 生成した記事の一覧を表示
- タイトル、生成日時、文字数、ステータスを表示
- フィルタ機能（下書き/完成）
- 検索機能（タイトル・本文）
- ページネーション（20件/ページ）

#### FR-007-2: 記事保存
- 自動保存（30秒ごと）
- 手動保存ボタン
- 下書き / 完成 のステータス管理
- 最大保存数: 100件

#### FR-007-3: 記事削除
- 保存した記事を削除
- 削除確認ダイアログ
- 削除後30日間は復元可能

#### FR-007-4: 記事複製
- 既存記事をベースに新規作成
- 設定・スタイルを引き継ぐ

**実装方法**: DynamoDB  
**優先度**: 中  
**関連**: 03_database_schema.md

---

## 🚫 非機能要件

### NFR-001: パフォーマンス

#### NFR-001-1: レスポンス時間
- 記事生成API: p95 < 60秒
- チャット修正API: p95 < 30秒
- フロント初回読み込み: < 3秒
- ブロックエディタ操作: < 100ms

#### NFR-001-2: スケーラビリティ
- 同時ユーザー: 100人対応
- 1ユーザーあたり同時リクエスト: 3件

**測定方法**: CloudWatch, Lighthouseスコア  
**関連**: 09_testing_strategy.md

---

### NFR-002: セキュリティ

#### NFR-002-1: 認証・認可
- JWT トークンでAPI認証
- トークン有効期限: 1時間（自動更新）
- HTTPS通信必須

#### NFR-002-2: データ保護
- パスワードはハッシュ化（Cognito管理）
- S3バケットは非公開
- DynamoDB暗号化有効
- サンプル記事の暗号化保存

#### NFR-002-3: 入力バリデーション
- すべてのユーザー入力をサニタイズ
- XSS対策
- HTMLタグのエスケープ
- URLの検証（内部リンク）

**実装方法**: AWS WAF, Cognito, Lambda Authorizer  
**関連**: 02_architecture.md, 06_backend_design.md

---

### NFR-003: 可用性

#### NFR-003-1: 稼働率
- 目標稼働率: 99.5%以上
- 計画メンテナンス: 月1回、最大2時間

#### NFR-003-2: エラーハンドリング
- Lambda エラー率: < 1%
- 記事生成失敗時の自動リトライ（最大3回）
- ユーザーフレンドリーなエラーメッセージ

#### NFR-003-3: データ保全
- 自動保存による作業ロスト防止
- 修正履歴の保持（10世代）
- 削除記事の30日間保持

**監視方法**: CloudWatch Alarms  
**関連**: 08_deployment_guide.md

---

### NFR-004: ユーザビリティ

#### NFR-004-1: レスポンシブデザイン
- デスクトップ: 1280px以上（推奨）
- タブレット: 768px-1279px
- モバイル: 375px-767px（表示のみ、編集は非推奨）

#### NFR-004-2: アクセシビリティ
- キーボード操作対応
- スクリーンリーダー対応
- カラーコントラスト比 4.5:1以上
- WCAG 2.1 Level AA準拠

#### NFR-004-3: ブラウザ対応
- Chrome（最新版） - 推奨
- Safari（最新版）
- Firefox（最新版）
- Edge（最新版）

#### NFR-004-4: 学習コスト
- 初回利用時のチュートリアル
- ツールチップによるヘルプ
- サンプル記事でのデモ

**検証方法**: Lighthouse, axe DevTools  
**関連**: 05_frontend_design.md

---

### NFR-005: 保守性

#### NFR-005-1: コード品質
- TypeScript型カバレッジ: 80%以上
- ESLintルール遵守
- コードレビュー必須
- 単体テストカバレッジ: 70%以上

#### NFR-005-2: ドキュメント
- すべてのAPI仕様を文書化
- コンポーネント仕様を文書化
- プロンプトテンプレートの文書化
- デプロイ手順を文書化

#### NFR-005-3: ログ・監視
- すべてのAPI呼び出しをログ記録
- Claude API使用量の記録
- エラーログの保持期間: 30日
- パフォーマンスメトリクスの記録

**ツール**: CloudWatch Logs, CloudWatch Metrics  
**関連**: 08_deployment_guide.md

---

## 🔄 将来的な追加要件（参考）

以下は初期リリースでは実装しないが、将来的に追加予定の要件：

### 将来要件-001: テーマ別最適化
- 人気WordPressテーマ（Cocoon、SWELL、JIN）専用の出力最適化
- テーマ固有のショートコード対応
- テーマのカラースキーム自動適用

### 将来要件-002: AI画像生成
- 記事に合った画像をAIで生成
- アイキャッチ画像の自動生成
- 図表・イラストの生成

### 将来要件-003: SEO分析
- キーワード密度分析
- 内部リンク最適化提案
- 競合記事との比較
- 検索意図の分析

### 将来要件-004: 多言語対応
- 記事の自動翻訳
- 多言語SEO対応
- 言語別のトーン調整

### 将来要件-005: チーム機能
- 複数ユーザーでの記事共同編集
- コメント機能
- 承認フロー

### 将来要件-006: WordPress連携強化
- WordPressプラグイン提供
- 直接投稿機能（REST API）
- カスタム投稿タイプ対応

→ 詳細は **10_change_log.md** で機能追加時に記録

---

## 📊 要件の優先度マトリクス

| 要件ID | 機能 | 優先度 | 初期リリース | 実装難易度 |
|--------|------|--------|------------|-----------|
| FR-001 | ユーザー認証 | 高 | ✅ | 低（Cognito） |
| FR-002 | 記事初期設定 | 高 | ✅ | 中 |
| FR-003 | 記事生成 | 高 | ✅ | 高 |
| FR-004 | チャット修正 | 高 | ✅ | 高 |
| FR-005 | エディタ | 高 | ✅ | 高 |
| FR-006 | 出力機能 | 高 | ✅ | 中 |
| FR-007 | 記事管理 | 中 | ✅ | 低 |

---

## 🎯 受け入れ基準

各要件の完了判定基準：

### FR-001 受け入れ基準
- [ ] ユーザー登録→メール認証→ログインが動作
- [ ] パスワードリセットが動作
- [ ] セッション管理が正常に動作

### FR-002 受け入れ基準
- [ ] 記事スタイル設定が保存できる
- [ ] サンプル記事をアップロードできる（最大3記事）
- [ ] 装飾プリセットを選択できる
- [ ] 設定が記事生成に反映される

### FR-003 受け入れ基準
- [ ] 本文の要点のみで記事生成できる
- [ ] タイトル未入力時、3案が提示される
- [ ] メタディスクリプション、キーワード、スラッグが生成される
- [ ] 内部リンクが適切に挿入される
- [ ] Gutenbergブロック形式で出力される

### FR-004 受け入れ基準
- [ ] チャットで記事修正指示ができる
- [ ] 部分選択して修正できる
- [ ] 修正履歴が保存される（最大10件）
- [ ] 元に戻す機能が動作する

### FR-005 受け入れ基準
- [ ] Gutenbergブロックエディタが動作する
- [ ] ブロックの追加・削除・並び替えができる
- [ ] リアルタイムプレビューが動作する
- [ ] レスポンシブプレビューが動作する

### FR-006 受け入れ基準
- [ ] Gutenbergブロック形式でエクスポートできる
- [ ] メタ情報がコピーできる
- [ ] HTMLファイルがダウンロードできる
- [ ] WordPressに貼り付けて正常に動作する

### FR-007 受け入れ基準
- [ ] 記事一覧が表示される
- [ ] 自動保存が動作する（30秒ごと）
- [ ] 記事の検索・フィルタが動作する
- [ ] 記事の削除・復元が動作する

---

## 🔗 制約事項

### 技術的制約
- Claude API: トークン制限（入力200K, 出力16K）
- Lambda: タイムアウト15分、メモリ最大10GB
- DynamoDB: 項目サイズ最大400KB
- Cognito: 無料枠 50,000 MAU
- サンプル記事: 1記事あたり最大100KB

### ビジネス的制約
- 開発期間: 4-5ヶ月
- 初期コスト: $300/月以内
- 初期ユーザー数: 50人想定

### ユーザビリティ的制約
- モバイルでの編集は非推奨（表示のみ）
- サンプル記事は最大3記事まで
- 内部リンクは1記事あたり最大5記事

---

## 📝 変更管理

要件の変更が発生した場合：

1. **10_change_log.md** に変更理由・影響範囲を記録
2. このドキュメントを更新
3. 関連ドキュメント（02, 03, 04, 05, 06）の更新確認
4. **99_task_management.md** でタスクを調整

---

**最終更新**: 2025-01-03  
**承認者**: れんじろう  
**次回レビュー**: Phase 1完了時